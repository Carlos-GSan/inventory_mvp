<!-- Tabla de transacciones -->
{% if recent_transactions %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Tipo</th>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Nota</th>
            </tr>
        </thead>
        <tbody>
            {% for txn in recent_transactions %}
            <tr>
                <td>{{ txn.happened_at|date:"d/m/Y H:i" }}</td>
                <td>
                    {% if txn.txn_type == "PURCHASE" %}
                    <span class="badge text-bg-success">Compra</span>
                    {% elif txn.txn_type == "ISSUE" %}
                    <span class="badge text-bg-warning">Salida</span>
                    {% else %}
                    <span class="badge text-bg-secondary">Ajuste</span>
                    {% endif %}
                </td>
                <td>{{ txn.item.sku }} - {{ txn.item.description }}</td>
                <td>{{ txn.qty }}</td>
                <td>{{ txn.note|default:"-" }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Paginación -->
{% if recent_transactions.has_other_pages %}
<nav aria-label="Navegación de transacciones">
    <ul class="pagination justify-content-center mb-0">
        {% if recent_transactions.has_previous %}
        <li class="page-item">
            <a class="page-link" 
               hx-get="?page=1{% if item_filter %}&item={{ item_filter }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}"
               hx-target="#transactions-container"
               hx-swap="innerHTML">
                <i class="bi bi-chevron-double-left"></i>
            </a>
        </li>
        <li class="page-item">
            <a class="page-link" 
               hx-get="?page={{ recent_transactions.previous_page_number }}{% if item_filter %}&item={{ item_filter }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}"
               hx-target="#transactions-container"
               hx-swap="innerHTML">
                <i class="bi bi-chevron-left"></i>
            </a>
        </li>
        {% endif %}
        
        {% for num in recent_transactions.paginator.page_range %}
            {% if recent_transactions.number == num %}
            <li class="page-item active">
                <span class="page-link">{{ num }}</span>
            </li>
            {% elif num > recent_transactions.number|add:'-3' and num < recent_transactions.number|add:'3' %}
            <li class="page-item">
                <a class="page-link" 
                   hx-get="?page={{ num }}{% if item_filter %}&item={{ item_filter }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}"
                   hx-target="#transactions-container"
                   hx-swap="innerHTML">
                    {{ num }}
                </a>
            </li>
            {% endif %}
        {% endfor %}
        
        {% if recent_transactions.has_next %}
        <li class="page-item">
            <a class="page-link" 
               hx-get="?page={{ recent_transactions.next_page_number }}{% if item_filter %}&item={{ item_filter }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}"
               hx-target="#transactions-container"
               hx-swap="innerHTML">
                <i class="bi bi-chevron-right"></i>
            </a>
        </li>
        <li class="page-item">
            <a class="page-link" 
               hx-get="?page={{ recent_transactions.paginator.num_pages }}{% if item_filter %}&item={{ item_filter }}{% endif %}{% if date_from %}&date_from={{ date_from }}{% endif %}{% if date_to %}&date_to={{ date_to }}{% endif %}"
               hx-target="#transactions-container"
               hx-swap="innerHTML">
                <i class="bi bi-chevron-double-right"></i>
            </a>
        </li>
        {% endif %}
    </ul>
</nav>

<div class="text-center mt-2 text-muted">
    <small>
        Página {{ recent_transactions.number }} de {{ recent_transactions.paginator.num_pages }} 
        ({{ recent_transactions.paginator.count }} transacciones en total)
    </small>
</div>
{% endif %}
{% else %}
<p class="text-center text-muted p-4">No hay transacciones que coincidan con los filtros</p>
{% endif %}
